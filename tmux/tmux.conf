# --- SYSTEM CONFIG ---
set -g default-shell /usr/bin/zsh
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"

# --- PREFIX ---
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# --- BASICS ---
set -g status-position top
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on
set -g mouse on
set -g escape-time 0
set -g history-limit 1000000
set -g detach-on-destroy off
set -g set-clipboard on

# --- RELOAD ---
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded"

# --- SMART NAVIGATION (NVIM + TMUX with ALT + HJKL) ---
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?|fzf)(diff)?$'"

bind-key -n 'M-h' if-shell "$is_vim" 'send-keys M-h'  'select-pane -L'
bind-key -n 'M-j' if-shell "$is_vim" 'send-keys M-j'  'select-pane -D'
bind-key -n 'M-k' if-shell "$is_vim" 'send-keys M-k'  'select-pane -U'
bind-key -n 'M-l' if-shell "$is_vim" 'send-keys M-l'  'select-pane -R'

# --- WINDOW SWITCHING ---
bind-key -n M-1 select-window -t 1
bind-key -n M-2 select-window -t 2
bind-key -n M-3 select-window -t 3
bind-key -n M-4 select-window -t 4
bind-key -n M-5 select-window -t 5
bind-key -n M-6 select-window -t 6
bind-key -n M-7 select-window -t 7
bind-key -n M-8 select-window -t 8
bind-key -n M-9 select-window -t 9

# --- SPLITS & WINDOWS ---
bind v split-window -h -c "#{pane_current_path}"
bind s split-window -v -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"
bind x kill-pane

# --- RESIZE ---
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5
bind -r m resize-pane -Z

# --- COPY MODE (VI) ---
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send-keys -X copy-pipe-and-cancel "wl-copy"
bind-key -T copy-mode-vi 'M-h' select-pane -L
bind-key -T copy-mode-vi 'M-j' select-pane -D
bind-key -T copy-mode-vi 'M-k' select-pane -U
bind-key -T copy-mode-vi 'M-l' select-pane -R

# --- TOKYO NIGHT THEME ---
set -g status-justify centre

tn_bg="#1a1b26"
tn_fg="#a9b1d6"
tn_blue="#7aa2f7"
tn_magenta="#bb9af7"
tn_yellow="#e0af68"
tn_comment="#565f89"
tn_purple="#9d7cd8"

set -g status-style "fg=${tn_fg},bg=default"
set -g status-left-length 50
set -g status-left "#{?pane_in_mode,#[fg=${tn_yellow}]#[bold]  COPY ,#[fg=${tn_magenta}]#[bold]  NORMAL }#[fg=${tn_comment},nobold]"
set -g status-right-length 50
set -g status-right "#[fg=${tn_purple},bold]  #S "
set -g window-status-current-format "#[fg=${tn_blue},bold,underscore] #I:#W "
set -g window-status-format " #[fg=${tn_comment}] #I:#W "
set -g pane-border-style "fg=${tn_comment}"
set -g pane-active-border-style "fg=${tn_blue}"
set -g message-style "fg=${tn_blue},bg=${tn_bg},bold"
set -g mode-style "fg=${tn_bg},bg=${tn_blue},bold"

# --- SESSIONIZER ---
bind-key -r f run-shell "tmux neww ~/.local/bin/tmux-sessionizer"
